---
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: jitsi
spec:
  interval: 1h
  url: "https://jitsi-contrib.github.io/jitsi-helm"
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: jitsi
spec:
  interval: 15m
  chart:
    spec:
      chart: jitsi-meet
      version: 2.9.0
      sourceRef:
        kind: HelmRepository
        name: jitsi
  maxHistory: 3
  install:
    createNamespace: true
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  uninstall:
    keepHistory: false
  values:
    coturn:
      enabled: true
      turns:
        enabled: true
        certificate:
          create: false
          existingSecretName: deangalvin-dev-production-tls
    prosody:
      service:
        type: LoadBalancer
        externalTrafficPolicy: Local
      persistence:
        enabled: false
        size: 32Gi
        storageClassName: replica-block
    publicURL: https://meet.deangalvin.dev
    turnHost: meet-turn.deangalvin.dev
    excalidraw:
      enabled: true
    jvb:
      service:
        type: LoadBalancer
        externalTrafficPolicy: Local
    jibri:
      enabled: false
      singleUseMode: true
      persistence:
        enabled: true
        size: 32Gi
        storageClassName: replica-block
    web:
      ingress:
        enabled: true
        hosts:
        - host: meet.deangalvin.dev
          paths: ["/"]
        tls:
        - hosts:
          - meet.deangalvin.dev
          secretName: deangalvin-dev-production-tls
