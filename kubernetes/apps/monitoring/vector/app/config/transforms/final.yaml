type: remap
inputs:
  - "*_remapped"
  - router._unmatched
source: |
  tmp = del(.)

  .timestamp = tmp.timestamp
  .message = tmp.message
  .level = tmp.level || "debug"

  .labels = tmp.labels || {}
  .labels.vector_config_version = "1"
  .labels.source_file = tmp.file
  .labels.kubernetes_container_image = tmp.kubernetes.container_image
  .labels.kubernetes_container_name = tmp.kubernetes.container_name
  .labels.kubernetes_pod = tmp.kubernetes.pod_name
  .labels.kubernetes_namespace = tmp.kubernetes.pod_namespace
  .labels.kubernetes_node = tmp.kubernetes.pod_node_name

  if exists(tmp.kubernetes.node_labels."topology.rook.io/chassis") {
    .labels.kubernetes_chassis = tmp.kubernetes.node_labels."topology.rook.io/chassis"
  }

  if exists(tmp.kubernetes.pod_labels."app.kubernetes.io/name") {
    .labels.kubernetes_name = tmp.kubernetes.pod_labels."app.kubernetes.io/name"
  }

  if exists(tmp.kubernetes.pod_labels."app.kubernetes.io/component") {
    .labels.kubernetes_component = tmp.kubernetes.pod_labels."app.kubernetes.io/component"
  }

  if exists(tmp.kubernetes.pod_labels."app.kubernetes.io/instance") {
    .labels.kubernetes_instance = tmp.kubernetes.pod_labels."app.kubernetes.io/instance"
  }
