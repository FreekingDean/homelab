type: remap
inputs:
  - "*_remapped"
  - "*_router._unmatched"
source: |
  tmp = del(.)

  .timestamp = tmp.timestamp
  .message = tmp.message
  .level = tmp.level || "unknown"

  .data = tmp.data || {}
  .labels = tmp.labels || {}
  .service_name = tmp.service_name || "unknown_service"

  if exists(.data.request) && exists(.data.request.status) && .level == "unknown" {
    .level = "info"
    status, err = to_int(.data.request.status)
    if err == null && status >= 500 {
      .level = "error"
    }
  }
